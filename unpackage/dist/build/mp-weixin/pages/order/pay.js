(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/pay"],{"3b9b":function(e,t,n){"use strict";(function(e){n("cd49");a(n("66fd"));var t=a(n("8de9"));function a(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("543d")["createPage"])},"3f74":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;getApp();var n={data:function(){return{mealIndex:0,couponList:[{name:"没有可用的优惠券",id:null,discount:0}],payType:1,orderDetail:null,orderId:null,downTimes:0,degree:0}},onLoad:function(e){this.orderId=e.id,this.getDetail(),this.getUserInfo()},methods:{getDetail:function(){var e=this;this.$api.order.payDetail.request({orderId:this.orderId}).then((function(t){e.orderDetail=t,e.getCouponList(),e.payDownTime(t.downtime)}))},getCouponList:function(){var e=this;this.$api.user.coupon.request().then((function(t){var n=[];n=0==t.total?[{name:"没有可用的优惠券",id:null,discount:e.orderDetail.package_price}]:[{name:"你有"+t.total+"张可用的优惠券",id:null,discount:e.orderDetail.package_price}];var a=t.results;a.map((function(t,n){t.name="￥"+t.discount+"/"+t.name,e.orderDetail.coupon&&e.orderDetail.coupon.id==t.id&&e.setData({mealIndex:n+1})}));var i=n.concat(a);e.couponList=i}))},getUserInfo:function(){var e=this;this.$api.user.info.request().then((function(t){e.degree=t.degree}))},choosePay:function(e){this.payType=e},bindPickerChange:function(e){console.log("picker发送选择改变，携带值为",e.detail.value),0==e.detail.value?this.orderDetail.pay_price=parseFloat(this.couponList[e.detail.value].discount):this.orderDetail.pay_price=this.couponList[0].discount-parseFloat(this.couponList[e.detail.value].discount),this.setData({mealIndex:e.detail.value,orderDetail:this.orderDetail})},toPay:function(){var e=this;this.$api.order.payConfirm.request({id:e.orderId,pay_method:e.payType,coupon_id:e.couponList[e.mealIndex].id?e.couponList[e.mealIndex].id:null}).then((function(t){1==e.payType?e.wxpay():e.balancePays()}))},wxpay:function(){var t=this;this.$api.order.pay.request({orderId:t.orderId,type:"wx"}).then((function(n){e.requestPayment({timeStamp:String(n.timeStamp),nonceStr:n.nonceStr,package:n.package,signType:n.signType,paySign:n.paySign,success:function(n){e.showModal({title:"提示",content:"支付成功",showCancel:!1,success:function(n){n.confirm&&e.redirectTo({url:"/pages/my/orderDetail?id="+t.orderId})}})},fail:function(t){e.showModal({title:"提示",content:"支付取消或失败",showCancel:!1,success:function(e){e.confirm}})}})}))},balancePays:function(){var t=this;this.$api.order.pay.request({orderId:t.orderId,type:"balance"}).then((function(n){e.redirectTo({url:"/pages/my/orderDetail?id="+t.orderId})}))},payDownTime:function(e){var t=e,n=this,a=setInterval((function(){0==--t&&(clearInterval(a),n.cancelOrderPost(),n.setData({downTimes:0})),parseInt(t/60/60/24);var e=parseInt(t/60/60%24),i=parseInt(t/60%60),o=parseInt(t%60);e<10&&(e="0"+e),i<10&&(i="0"+i),o<10&&(o="0"+o),n.setData({downTimes:i+"分钟"+o+"秒"})}),1e3)},cancelOrderPost:function(){var t=this;this.$api.order.cancel.request({orderId:t.orderId}).then((function(t){e.showModal({title:"订单超时,已自动取消",content:"",showCancel:!1,success:function(t){t.confirm&&e.navigateBack({})}})}))},jumpMember:function(){e.navigateTo({url:"/pages/order/balanceRecharge"})}}};t.default=n}).call(this,n("543d")["default"])},4045:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}));var i=function(){var e=this,t=e.$createElement;e._self._c},o=[]},"8de9":function(e,t,n){"use strict";n.r(t);var a=n("4045"),i=n("fcf1");for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("b276");var r,c=n("f0c5"),u=Object(c["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],r);t["default"]=u.exports},b276:function(e,t,n){"use strict";var a=n("e540"),i=n.n(a);i.a},e540:function(e,t,n){},fcf1:function(e,t,n){"use strict";n.r(t);var a=n("3f74"),i=n.n(a);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a}},[["3b9b","common/runtime","common/vendor"]]]);